# 主要规则

比赛双方提交作品（dll库或者jar包）参加比赛。由server（box.exe主程序）负责拉起比赛。

比赛地图是X行Y列（上图X=19，Y=19）。每个比赛作品可以控制己方的3个“小人”，分居地图左右两侧
（左方为 红色块 示意，右方为 绿色块 示意）

地图上有若干只箱子（黄色块示意）。能先将半数的箱子推至目的地的一方即为胜利。（左方的目的地为最右侧列，右方目的地为最左侧列） 箱子数量若干。

地图上有若干个障碍点（又叫篱笆，黑色块示意），双方人员、箱子均不能进入。

比赛为回合制。一个回合内，双方程序各自计算，选择己方3个小人中的1人进行移动。并将此小人的移动方向提交server。 server收到双方提交结果后，进行结算并进入下一回合。在既定总回合（例如400回合）内，双方分出胜负后结束。

每场比赛的地图都是随机产生的。但对比赛双方仍然是公平的：因为地图呈180度旋转对称。


## 2.1 地图

地图是一个有X行Y列的矩形，一共有X*Y格。每格里面的内容是“空地”、“左方人员”、“右方人员”、“箱子”、“障碍”之一。



一个格子只能有一个确切的内容物。不能同时有多个内容。例如：不存在2个小人在一个格子内的情况，也不存在人与箱子在同一个格子内的情况，等等。



地图的外框是有界封闭的。可以视作地图的外围全部是障碍。

## 2.2 小人

虽然地图是随机的，然而双方的3个小人的初始位置是固定的。分别在最左侧、最右侧的上、中、下三个固定位置。

一方在一个回合内最多能指定1个小人进行移动。当然也可以不指定（相当于放弃此回合）。

移动的方向只能是上下左右四个方向。不支持斜向移动等。

一个回合只能沿着移动方向移动一个格子。

一方提交的移动方向，将被server结算。如果被server认为不可行， 将不执行此提交。而且，Server也不会给该方在本轮内重新提交的机会。

例如: 某方想将某小人移动到障碍点上面：该回合结束后，此小人将维持在原地。

又例如：双方都想进入同一个格子，该回合结束后，双方小人将维持在原地。

## 2.3 箱子

箱子初始呈随机分布。但是这个初始分布也是有基本规律的：
呈180度旋转对称。

人员所在的行(即最上/最下/中间3行)，没有箱子

箱子本身不会移动，只要靠人员推动才可以移动。人在移动过程中，旁边有箱子，即可形成“推动”。其结果是：箱子沿着人移动的方向移动一格。 人也跟着移动一格（实际上就移动到原先箱子所在的位置）。

推动的前提是箱子的目的地是空地或者“即将被腾空”，细节参见2.6节

小人1次只能推动1个箱子，不能一次性推动连续挨着的多个箱子

箱子的最终目的地是：最左方列或者最右方列。箱子进入最左侧列视作右方得分，进入最右侧列视作左方得分。无论这个箱子是哪方推入的。（例如，左方人员应该将箱子推至右方目的地。但如果它错误地将箱子推至左方目的地了，则视作右方得分，好比足球赛的“乌龙球”）

箱子进入目的地后，仍然可以被移动（例如上下移动）。但显然，进入目的地的箱子总归是无法逃离目的地的。

## 2.4 障碍

障碍初始呈随机分布。但是这个初始分布也是有基本规律的，即呈180度旋转对称。

在一场比赛内，障碍点不会再发生变更（新增、删除、移动），永久有效。

默认只有1个障碍且位于地图中心。 可以通过设定命令行参数-fence指定其他的障碍数。

初学者可以先行设定-fence0来设定一个没有任何障碍的地图，简化算法。后续再设定更多的障碍。

正式比赛采用的障碍数请参考2.8节“数字设定”。

## 2.5 回合

这里的回合制和“下棋”不同。下棋分先后手，先手走一步，后手走一步，交替执行。推箱子比赛不分先后手，一个回合内双方同时执行，将结果交给server结算。结算后进入下一回合。

回合制的赛制决定了胜负只和算法有关，和运行速度无关。某方程序计算的再快，也不可能比别人多走一轮。
当然，server也不会容忍一方耗用无尽的时间。 当一方运算时间超长时，程序判负。例如：Dll程序单回合时间开销不得超过40ms， Jar程序单回合时间开销不得超过100ms。（考虑java执行慢于C/C++）。

注：以上为上限。并不是平均值。程序编写时请保持适当的时间冗余。如果平时运行就要花38ms，那么某个round下超过40ms就很可能发生了。另一方面，请保持算法的时间复杂度的稳定性。不要因为某个复杂场景使得时间开销呈指数级上升。

如果双方程序过强或者过弱，有可能任何一方都不能在有限时间内把半数的箱子推至目的地。为了避免Server陷入无穷运转，server有最大回合数的设定。Server最多运行最大回合数后停止。

## 2.6 Server结算过程

Server收到双方提交的出招后，进行判定的过程是：先做“无效出招”过滤(2.6.1)，再做相容性判断(2.6.2)。

略



## 2.8 数字设定

正式比赛时，各数字设定如下：

- 地图大小：19*19格

- 箱子数量：16

- 障碍数量：15

- 最大回合数：400

- Player单回合运算时间上限：C/C++: 40ms; Java:100ms

  

## 2.9 特别情形

- 为了方便比赛和批跑，server平台和player是命令行启动，且为本地进程加载的执行方式。并非网络CS模式。因此各参赛者的程序出现异常（例如内存越界访问等）造成server退出的，直接判负。（server会有断点记录，可以证实是哪方出现的异常）
- 本比赛是以业务逻辑编码以及算法竞技为目的，因此禁止采用特定攻击技术使得server运行异常，或者干扰对方player执行。
